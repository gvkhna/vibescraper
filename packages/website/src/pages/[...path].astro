---
import AppLayout from '@/layouts/app-layout.astro'
import {Webapp} from '@/partials/webapp/webapp'
import {PUBLIC_VARS} from '@/vars.public'

// Want to handle this client side in the tanstack router
// if (!Astro.locals.session) {
//   return Astro.redirect('/expired')
// }
---

<AppLayout
  title='Vibescraper'
  desc='Web scraping and data extraction platform with AI-powered tools'
>
  <Webapp
    client:only='react'
    publicEnv={PUBLIC_VARS}
  />
  <debug-logger
    data-public-debug={PUBLIC_VARS.PUBLIC_DEBUG}
    class='hidden'
  ></debug-logger>
  <script>
    import debug from 'debug'
    class DebugLogger extends HTMLElement {
      constructor() {
        super()
      }

      connectedCallback() {
        if (
          globalThis.window &&
          globalThis.window.localStorage &&
          this.dataset.publicDebug
        ) {
          globalThis.window.localStorage.setItem('debug', this.dataset.publicDebug)
        }

        if (globalThis.window && globalThis.window.localStorage) {
          const debugVal = globalThis.window.localStorage.getItem('debug')
          if (debugVal) {
            debug.enable(debugVal)
            debug.log = console.info.bind(console)
          }
        }
      }
    }

    customElements.define('debug-logger', DebugLogger)
  </script>
</AppLayout>
